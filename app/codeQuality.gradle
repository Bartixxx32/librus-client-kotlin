apply plugin: "jacoco"

def autoGenerated = ['**/R.class',
                     '**/R$*.class',
                     '**/Manifest*.*',
                     'android/**/*.*',
                     '**/BuildConfig.*',
                     '**/*$ViewBinder*.*',
                     '**/*$ViewInjector*.*',
                     '**/Lambda$*.class',
                     '**/Lambda.class',
                     '**/*Lambda.class',
                     '**/*Lambda*.class']

task("jacocoUnitTestReport", type: JacocoReport, dependsOn: "testDebugUnitTest") {
    group "Reporting"
    description "Generate Debug Jacoco coverage reports."

    reports {
        xml.enabled = true
        html.enabled = true
    }

    // variant.javaCompile.source does not work
    // traverses from starting point
    sourceDirectories = files(android.sourceSets.main.java.srcDirs)
    classDirectories = fileTree(dir: "${buildDir}/tmp/kotlin-classes/debug", excludes: autoGenerated)
    executionData = fileTree(dir: "$buildDir", includes: [
            "jacoco/testDebugUnitTest.exec"
    ])
}